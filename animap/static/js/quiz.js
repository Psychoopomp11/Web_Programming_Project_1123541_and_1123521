const questionBank = {
    China: [
      {
        "question": "What is a special feature of the Golden Snub-Nosed Monkey that helps it stay warm in cold winters?",
        "options": ["It grows extra thick fur.", "It eats more food.", "It builds a nest.", "It hibernates."],
        "correct": 0
      },
      {
        "question": "Where does the Chinese Sturgeon go every year to lay its eggs?",
        "options": ["To the ocean.", "To freshwater rivers.", "To the mountains.", "To a sandy beach."],
        "correct": 1
      },
      {
        "question": "What makes the Chinese Giant Salamander unique among amphibians?",
        "options": ["It has brightly colored skin.", "It is the largest amphibian in the world.", "It can fly like a dragon.", "It lives in deserts."],
        "correct": 1
      },
      {
        "question": "How far can the Black Crested Gibbon swing in a single leap?",
        "options": ["5 meters", "10 meters", "15 meters", "20 meters"],
        "correct": 2
      },
      {
        "question": "What is the White-shouldered Ibis known for?",
        "options": ["Being the largest bird in Southeast Asia.", "Using its bill to dig through mud for food.", "Building nests in tall trees.", "Flying long distances across deserts."],
        "correct": 1
      },
      {
        "question": "Which unique feature makes the Sumatra Rhinoceros different from other rhino species?",
        "options": ["It has the largest horns of all rhinos.", "It is covered in bristly hair.", "It is the fastest runner among rhinos.", "It can swim long distances."],
        "correct": 1
      },
      {
        "question": "Why is the Chinese Alligator nicknamed the 'mud dragon'?",
        "options": ["It can breathe underwater for hours.", "It loves to burrow into mud for warmth and protection.", "It has scales that resemble dragon skin.", "It can change its color to blend into muddy environments."],
        "correct": 1
      }],
      Indonesia: [
        {
          "question": "What is the Komodo Dragon known for?",
          "options": ["Flying through the air", "Being the largest lizard in the world", "Having rainbow-colored skin", "Eating only plants"],
          "correct": 1
        },
        {
          "question": "Where can you find the Anoa in the wild?",
          "options": ["On the moon", "In the deserts of Africa", "On the Indonesian islands of Sulawesi and Buton", "In the North Pole"],
          "correct": 2
        },
        {
          "question": "Why is the Javan Rhino critically endangered?",
          "options": ["They don’t like to eat", "Their horns are too heavy", "Habitat loss and poaching", "They are afraid of water"],
          "correct": 2
        },
        {
          "question": "What do Sumatran Tigers mainly eat?",
          "options": ["Ice cream and cookies", "Medium-sized mammals like deer and wild boar", "Grass and leaves", "Fish and chips"],
          "correct": 1
        },
        {
          "question": "Where is the Mentawai Macaque found?",
          "options": ["Java Island", "Sumatra Island", "Mentawai Islands", "Bali"],
          "correct": 2
        },
        {
          "question": "What is unique about Wallace's Standardwing?",
          "options": ["It can swim underwater.", "It has long feathers that look like wings during mating displays.", "It lives only in deserts.", "It changes colors like a chameleon."],
          "correct": 1
        },
        {
          "question": "What color is the Bali Starling's body?",
          "options": ["Red", "Green", "White", "Blue"],
          "correct": 2
        }], 
      India: [
        {
          "question": "What makes the Spoon-billed Sandpiper's beak unique?",
          "options": ["It is very long and sharp.", "It is spoon-shaped.", "It is curved.", "It is flat and wide."],
          "correct": 1
        },
        {
          "question": "What is the biggest threat to vultures like the White-rumped Vulture?",
          "options": ["Habitat destruction", "Lack of food", "Poisoning from veterinary drugs", "Illegal hunting"],
          "correct": 2
        },
        {
          "question": "What is a fun fact about the Slender-billed Vulture?",
          "options": ["It can stay underwater for up to 30 seconds.", "It uses its beak like a shovel.", "It can glide for hours because it is light.", "It can eat up to 2 kilograms of food."],
          "correct": 2
        },
        {
          "question": "What is the Yellow-breasted Bunting's favorite food during migration?",
          "options": ["Insects", "Rice grains", "Fish", "Frogs"],
          "correct": 1
        },
        {
          "question": "Where does the Christmas Island Frigatebird nest?",
          "options": ["On trees in Africa", "On Christmas Island", "In caves", "On mountain tops"],
          "correct": 1
        },
        {
          "question": "What is a fun fact about the Siberian Crane?",
          "options": ["It has a trumpet-like call that can be heard from far away.", "It loves to swim underwater.", "It can live in the desert.", "It feeds on rice grains."],
          "correct": 0
        },
        {
          "question": "Why is the White-bellied Heron called a 'ghost bird'?",
          "options": ["It is very noisy.", "It is often seen at night.", "It is rarely seen or heard in the wild.", "It flies in the shape of a ghost."],
          "correct": 2
        }],
      Iran:[
        {
          "question": "What is the main food of the Oxus Cobra?",
          "options": ["Fish", "Fruits", "Rodents, birds, and small animals", "Grass"],
          "correct": 2
        },
        {
          "question": "Where does the Latifi’s Viper live?",
          "options": ["Desert", "Forests", "Elburz Mountains of Iran", "Ocean"],
          "correct": 2
        },
        {
          "question": "What do Dugongs eat?",
          "options": ["Seaweed", "Seagrass", "Small fish", "Jellyfish"],
          "correct": 1
        },
        {
          "question": "Why is the Hawksbill Turtle critically endangered?",
          "options": ["Due to its speed", "Because it is too small", "Due to poaching for its shell", "Because it is too big"],
          "correct": 2
        },
        {
          "question": "What do Green Turtles primarily eat?",
          "options": ["Fish", "Seagrass and algae", "Insects", "Small reptiles"],
          "correct": 1
        },
        {
          "question": "Where are Baluchistan Black Bears found?",
          "options": ["Arctic Tundra", "Balochistan province in Pakistan and parts of Iran", "African savannas", "Amazon Rainforest"],
          "correct": 1
        },
        {
          "question": "What is the Siberian Crane known for during mating season?",
          "options": ["Its loud calls", "Its elaborate courtship dances", "Building large nests", "Flying high above the clouds"],
          "correct": 1
        }],
      Japan: [
        {
          "question": "What makes the Amami Rabbit special?",
          "options": ["It can fly.", "It eats plants that are toxic to other animals.", "It has blue fur.", "It is very loud and active."],
          "correct": 1
        },
        {
          "question": "Where does the Iriomote Cat live?",
          "options": ["On the Amami Islands.", "In the Sahara Desert.", "On the island of Iriomote in Japan.", "In the Arctic Circle."],
          "correct": 2
        },
        {
          "question": "What is a fun fact about the Okinawa Rail?",
          "options": ["It can swim for miles.", "It is called a 'ghost bird' because it is hard to spot.", "It has bright blue feathers.", "It is the fastest flying bird in Japan."],
          "correct": 1
        },
        {
          "question": "What is the Ryukyu Long-haired Rat known for?",
          "options": ["Flying in the sky.", "Having long, shaggy fur and being an excellent climber.", "Being the loudest animal in the forest.", "Living underwater."],
          "correct": 1
        },
        {
          "question": "What is the Japanese name for the Japanese Crested Ibis?",
          "options": ["Hanzaki", "Toki", "Mira", "Nippon"],
          "correct": 1
        },
        {
          "question": "What is the main food of the Dugong?",
          "options": ["Seagrass", "Small fish", "Frogs", "Insects"],
          "correct": 0
        },
        {
          "question": "Which bird is famous for its beautiful courtship dance?",
          "options": ["Japanese Crested Ibis", "Amami Woodcock", "Red-crowned Crane", "Japanese Giant Salamander"],
          "correct": 2
        }],
        Kyrghzstan: [
        {
          "question": "What is special about the Afghan Tortoise's survival in the desert?",
          "options": ["It can fly over the desert.", "It drinks water every day.", "It gets moisture from the plants it eats.", "It sleeps all year long."],
          "correct": 2
        },
        {
          "question": "What is the Altai Weasel good at?",
          "options": ["Swimming in rivers.", "Hunting prey with speed and agility.", "Building large nests.", "Singing songs to scare predators."],
          "correct": 1
        },
        {
          "question": "What makes the Apollo Butterfly special?",
          "options": ["It is very noisy and fast.", "Its wings are colorful and look like jewels.", "It can live for many years.", "It hides underwater during winter."],
          "correct": 1
        },
        {
          "question": "What can the Desert Monitor do to cool off in the heat?",
          "options": ["Hide under bushes.", "Dive into ponds and rivers.", "Fly to colder places.", "Dig into the snow."],
          "correct": 1
        },
        {
          "question": "What is the main reason the Corncrake population has declined?",
          "options": ["It eats too much food.", "Habitat destruction due to changes in farming.", "It cannot fly well.", "It lives in cities."],
          "correct": 1
        },
        {
          "question": "What unique ability does the Egyptian Vulture have?",
          "options": ["It can swim across rivers.", "It can use tools like rocks to break eggs.", "It can change its feather color.", "It builds nests in trees."],
          "correct": 1
        },
        {
          "question": "How does the Goitered Gazelle survive in dry, hot climates?",
          "options": ["By storing water in its throat.", "By running fast to find water.", "By eating only grass.", "By using its 'goiter' to conserve water."],
          "correct": 3
        }],      
      Mongolia:[
        {
          "question": "Where does the Altai Weasel live?",
          "options": ["In the rainforest", "In the Altai Mountains", "On a farm", "In the desert"],
          "correct": 1
        },
        {
          "question": "What is the Apollo Butterfly known for?",
          "options": ["Its loud sound", "Its white wings with black and red spots", "Its ability to swim", "Its ability to fly long distances"],
          "correct": 1
        },
        {
          "question": "What does the Black-tailed Godwit eat?",
          "options": ["Plants and fruit", "Invertebrates, small fish, and plants", "Other birds", "Only insects"],
          "correct": 1
        },
        {
          "question": "What sound does the Corncrake make?",
          "options": ["A chirp", "A 'crex-crex' call", "A whistle", "A growl"],
          "correct": 1
        },
        {
          "question": "Where can you find the Eurasian Otter?",
          "options": ["In the jungle", "In rivers, lakes, and coastal waters", "On mountains", "In deserts"],
          "correct": 1
        },
        {
          "question": "What is the male Great Bustard known for during mating season?",
          "options": ["Singing loudly", "Puffing up its chest feathers", "Dancing", "Building nests"],
          "correct": 1
        },
        {
          "question": "What is the Greater Spotted Eagle good at?",
          "options": ["Swimming", "Hunting from the sky", "Running fast", "Singing"],
          "correct": 1
        }],
      Philipphines:[
        {
          "question": "Where can you find the Philippine Eagle?",
          "options": ["Only in the Philippines", "Only in Africa", "In North America", "In Australia"],
          "correct": 0
        },
        {
          "question": "What does the Philippine Freshwater Crocodile eat?",
          "options": ["Only plants", "Only other crocodiles", "Fish and decaying animals", "Fruit"],
          "correct": 2
        },
        {
          "question": "What makes the Tamaraw different from other buffalo?",
          "options": ["It has long, straight horns", "It is smaller and has backward-curved horns", "It can fly", "It only eats fruits"],
          "correct": 1
        },
        {
          "question": "How long can the Philippine Freshwater Crocodile hold its breath underwater?",
          "options": ["10 minutes", "30 minutes", "1 hour", "5 minutes"],
          "correct": 1
        },
        {
          "question": "What makes the Visayan Warty Pig unique?",
          "options": ["It has colorful feathers", "It has warts on its face", "It can fly", "It has a long tail"],
          "correct": 1
        },
        {
          "question": "What is the main food of the Philippine Cockatoo?",
          "options": ["Fish", "Seeds, fruits, and nuts", "Grass", "Insects"],
          "correct": 1
        },
        {
          "question": "Why is the Negros Bleeding-heart bird named so?",
          "options": ["It has a green feather", "It has a red patch on its chest that looks like a bleeding heart", "It lives in the ocean", "It is very loud"],
          "correct": 1
        }],
      Russia:[
        {
          "question": "What is the main feature that helps the Amur Leopard camouflage in its snowy habitat?",
          "options": ["Its bright yellow coat", "Its thick and rosette-covered coat", "Its big size", "Its long tail"],
          "correct": 1
        },
        {
          "question": "What does the Saiga Antelope use its bulbous nose for?",
          "options": ["To store food", "To breathe underwater", "To filter dust and regulate air temperature", "To communicate with other animals"],
          "correct": 2
        },
        {
          "question": "How do Ussuri Dholes communicate while hunting in packs?",
          "options": ["By roaring loudly", "By using high-pitched whistles and vocalizations", "By dancing", "By running in circles"],
          "correct": 1
        },
        {
          "question": "What do Siberian Tigers primarily eat?",
          "options": ["Fruits", "Insects", "Deer, wild boar, and smaller mammals", "Fish"],
          "correct": 2
        },
        {
          "question": "What is the Snow Leopard known for?",
          "options": ["Having wings", "Its beautiful, thick fur and long, bushy tail", "Being a fast runner", "Being very social"],
          "correct": 1
        },
        {
          "question": "What is the main threat to the European Mink's survival?",
          "options": ["Strong winds", "Habitat destruction, pollution, and competition with American mink", "Extreme cold", "Lack of food"],
          "correct": 1
        },
        {
          "question": "What does the West Caucasian Tur eat?",
          "options": ["Fish", "Grasses, shrubs, and mosses", "Insects", "Fruits"],
          "correct": 1
        }],
      Korea:[
        {
          "question": "What is the nickname of the Asiatic Black Bear?",
          "options": ["Moon Bear", "Honey Bear", "Giant Panda", "Brown Bear"],
          "correct": 0
        },
        {
          "question": "What is special about the Chinese Water Deer?",
          "options": ["It has sharp tusks like a vampire", "It has a long tail", "It has wings", "It lives in the water only"],
          "correct": 0
        },
        {
          "question": "What does the Eurasian Otter love to do for fun?",
          "options": ["Climb trees", "Slide down muddy riverbanks", "Fly", "Build nests"],
          "correct": 1
        },
        {
          "question": "Where does the Asian Dowitcher travel every year?",
          "options": ["From the North Pole to the South Pole", "From Siberia to Southeast Asia", "From Africa to Europe", "From the ocean to the mountains"],
          "correct": 1
        },
        {
          "question": "What is special about the Baikal Teal?",
          "options": ["It can swim faster than other ducks", "It has colorful feathers like a rainbow", "It can fly long distances without stopping", "It lives in the desert"],
          "correct": 1
        },
        {
          "question": "What is the Seoul Pond Frog known for?",
          "options": ["It is a great swimmer", "It can jump from one lily pad to another", "It has glowing eyes", "It can fly"],
          "correct": 1
        },
        {
          "question": "How does the Chinese Egret catch its food?",
          "options": ["By diving underwater", "By waiting still in the water with its sharp beak", "By flying through the air and catching insects", "By swimming with its wings"],
          "correct": 1
        }],
      Taiwan:[
        {
          "question": "What is special about the Formosan Flying Fox?",
          "options": ["It has a very small wingspan", "It is a type of fox", "It has a large wingspan and is a fruit bat", "It only eats insects"],
          "correct": 2
        },
        {
          "question": "What is the Formosan Salamander's favorite environment?",
          "options": ["Dry deserts", "Cold, snowy mountains", "Cool, moist environments like forests and streams", "Hot, sandy beaches"],
          "correct": 2
        },
        {
          "question": "What do Indo-Pacific Bottlenose Dolphins use to catch their food?",
          "options": ["Their sharp claws", "Their speed and strength", "Cooperation and echolocation", "Their big teeth"],
          "correct": 2
        },
        {
          "question": "What is a special feature of the Formosan Black Bear?",
          "options": ["It has a white crescent mark on its chest", "It can fly", "It only eats berries", "It is the smallest bear species"],
          "correct": 0
        },
        {
          "question": "What is the Taiwan Beauty Snake known for?",
          "options": ["Its venomous bite", "Its bright yellow, black, and white markings", "Its ability to fly", "Its loud roar"],
          "correct": 1
        },
        {
          "question": "What do Chinese Otters like to eat?",
          "options": ["Fruits and vegetables", "Small mammals", "Fish, crustaceans, and amphibians", "Grass"],
          "correct": 2
        },
        {
          "question": "Which bird is known for its melodious whistling songs in Taiwan?",
          "options": ["Peregrine Falcon", "Formosan Blue Magpie", "Formosan Whistling Thrush", "Taiwan Beauty Snake"],
          "correct": 2
        }],
      Vietnam:[
        {
          "question": "What is the Saola also known as?",
          "options": ["Unicorn of the Forest", "Asian Unicorn", "Mountain Deer", "Golden Lion"],
          "correct": 1
        },
        {
          "question": "Where can the Javan Rhinoceros be found?",
          "options": ["Africa", "Indonesia", "Vietnam", "India"],
          "correct": 1
        },
        {
          "question": "What is the main food of the Red-shanked Douc Langur?",
          "options": ["Leaves, fruits, and flowers", "Fish and small mammals", "Grass and leaves", "Insects"],
          "correct": 0
        },
        {
          "question": "How long do Siamese Crocodiles live in the wild?",
          "options": ["10-20 years", "30-40 years", "50-60 years", "70-80 years"],
          "correct": 2
        },
        {
          "question": "What is the main threat to the Saola?",
          "options": ["Lack of food", "Hunting and habitat destruction", "Competition with other animals", "Disease"],
          "correct": 1
        },
        {
          "question": "Where can you find the Javan Rhinoceros?",
          "options": ["Africa", "Australia", "Indonesia", "India"],
          "correct": 2
        },
        {
          "question": "What do Red-shanked Douc Langurs eat?",
          "options": ["Fish", "Leaves, fruits, and flowers", "Insects", "Nuts"],
          "correct": 1
        }] 
    };
  
  const motivationalMessages = {
    correct: ["🌟 AMAZING! You're a superstar! 🌟", "🎉 WOW! That's brilliant! 🎉", "🚀 You're soaring high! 🚀", "🌈 Fantastic work! You're magical! 🌈", "🏆 You're a champion! 🏆", "⭐ Super duper awesome! ⭐", "🎯 Bull's eye! Perfect shot! 🎯", "🌞 You're shining bright! 🌞", "🎨 You're painting success! 🎨", "🎸 You're rocking it! 🎸"],
    incorrect: ["🌱 Keep growing! You're learning! 🌱", "🌈 Every try makes you stronger! 🌈", "🎨 Let's paint a better picture next time! 🎨", "🎮 Level up and try again! 🎮", "🌟 Stars shine brightest after dark! 🌟", "🎪 The show must go on! 🎪", "🎨 Every artist was once a beginner! 🎨", "🚀 Ready for another launch! 🚀", "🎯 Almost there! Keep aiming! 🎯", "🎪 The fun's not over! 🎪"]
  };
  
  let questions = [];
  let currentQuestion = 0;
  let score = 0;
  let timerInterval;
  let answerSelected = false;
  let showRulesOnStart = true;
  const QUESTION_TIME = 20;
  
  particlesJS('particles-js', {
    particles: {
      number: {
        value: 50
      },
      color: {
        value: '#228B22'
      },
      shape: {
        type: 'circle'
      },
      opacity: {
        value: 0.5
      },
      size: {
        value: 3
      },
      move: {
        enable: true,
        speed: 2
      }
    }
  });
  
  function fireConfetti() {
    const defaults = {
      spread: 360,
      ticks: 200,
      gravity: 0.5,
      decay: 0.9,
      startVelocity: 30,
      shapes: ['star', 'circle', 'square'],
      colors: ['#228B22', '#32CD32', '#90EE90', '#98FB98', '#00FF00']
    };
    confetti({
      ...defaults,
      particleCount: 100,
      scalar: 1.2,
      shapes: ["star"]
    });
    setTimeout(() => {
      confetti({
        ...defaults,
        particleCount: 50,
        scalar: 0.75,
        shapes: ["circle"]
      });
    }, 150);
    setTimeout(() => {
      confetti({
        ...defaults,
        particleCount: 80,
        scalar: 1.1,
        shapes: ["square"]
      });
    }, 300);
  }
  
  function selectCategory(category) {
    questions = questionBank[category];
    document.getElementById('category-selection').style.display = 'none';
    document.getElementById('game-container').style.display = 'block';
    document.getElementById('rules-helper').style.display = 'none';
    currentQuestion = 0;
    score = 0;
    document.getElementById('score').textContent = score;
    loadQuestion();
  }
  
  function loadQuestion() {
    if (currentQuestion >= questions.length) {
      endGame();
      return;
    }
    answerSelected = false;
    const question = questions[currentQuestion];
    const questionElem = document.getElementById('question');
    questionElem.style.opacity = 0;
    questionElem.textContent = question.question;
    setTimeout(() => {
      questionElem.style.transition = 'opacity 0.5s ease';
      questionElem.style.opacity = 1;
    }, 100);
    const options = document.querySelectorAll('.option');
    options.forEach((option, index) => {
      option.style.animation = 'none';
      option.offsetHeight;
      option.style.animation = `bounceIn 0.5s cubic-bezier(0.36, 0, 0.66, -0.56) forwards ${index * 0.3}s`;
      option.style.opacity = 0;
      option.textContent = question.options[index];
      option.classList.remove('disabled', 'correct');
      setTimeout(() => {
        option.style.transition = 'opacity 0.5s ease';
        option.style.opacity = 1;
      }, 200 + index * 100);
    });
    updateProgressDots();
    startTimer();
  }
  
  function startTimer() {
    let timeLeft = QUESTION_TIME;
    const timerBar = document.getElementById('timer-bar');
    clearInterval(timerInterval);
    timerBar.style.transition = 'none';
    timerBar.style.width = '100%';
    setTimeout(() => {
      timerBar.style.transition = `width ${QUESTION_TIME}s linear`;
      timerBar.style.width = '0%';
    }, 50);
    timerInterval = setInterval(() => {
      timeLeft--;
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        showFeedback("Time's up!", false);
        setTimeout(nextQuestion, 3000);
      }
    }, 1000);
  }
  
  function checkAnswer(selected) {
    if (answerSelected) return;
    answerSelected = true;
    clearInterval(timerInterval);
    const correct = questions[currentQuestion].correct;
    document.querySelectorAll('.option').forEach(option => {
      option.classList.add('disabled');
    });
    if (selected === correct) {
      updateScore(100);
      document.getElementById('correct-sound').play();
      fireConfetti();
      showFeedback("Correct! +100 points!", true);
    } else {
      document.getElementById('incorrect-sound').play();
      showFeedback(`The correct answer was: ${questions[currentQuestion].options[correct]}`, false);
    }
    setTimeout(nextQuestion, 3000);
  }
  
  function showFeedback(message, isCorrect) {
    const feedback = document.getElementById('feedback');
    const motivational = isCorrect ? motivationalMessages.correct[Math.floor(Math.random() * motivationalMessages.correct.length)] : motivationalMessages.incorrect[Math.floor(Math.random() * motivationalMessages.incorrect.length)];
    feedback.style.opacity = 0;
    feedback.textContent = `${message} ${motivational}`;
    feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
    requestAnimationFrame(() => {
      feedback.style.transition = 'all 0.5s ease';
      feedback.style.opacity = 1;
      feedback.style.transform = 'scale(1.1)';
      setTimeout(() => {
        feedback.style.transform = 'scale(1)';
      }, 200);
    });
  }
  
  function nextQuestion() {
    currentQuestion++;
    document.getElementById('feedback').textContent = "";
    loadQuestion();
  }
  
  function endGame() {
    fireConfetti();
    document.getElementById('rules-helper').style.display = 'none';
    const celebration = score > questions.length * 100 / 2 ? '🎉 Fantastic Job! You\'re a Quiz Champion! 🏆' : '🌟 Great effort! Keep practicing! 💪';
    document.querySelector('.question-container').innerHTML = `
                              <div class="game-over-container">
                                  <h2>Game Over!</h2>
                                  <p>Final Score: ${score}</p>
                                  <p style="font-size: 3rem; margin: 1rem;">
                                      ${celebration}
                                  </p>
                                  <button class="game-over-btn" onclick="returnToCategories()">Play Again</button>
                              </div>
                          `;
    document.querySelector('.options-grid').style.display = 'none';
  }
  
  function returnToCategories() {
    if (showRulesOnStart) {
      showRules();
    } else {
      document.getElementById('category-selection').style.display = 'block';
    }
    document.getElementById('game-container').style.display = 'none';
    document.getElementById('rules-helper').style.display = 'block';
    document.querySelector('.options-grid').style.display = 'grid';
    document.querySelector('.question-container').innerHTML = `
                          <h2 id="question">Loading question...</h2>
                          <div class="timer">
                              <div class="timer-bar" id="timer-bar"></div>
                          </div>
                      `;
  }
  
  function updateProgressDots() {
    const progressContainer = document.getElementById('progress-dots');
    progressContainer.innerHTML = '';
    for (let i = 0; i < questions.length; i++) {
      const dot = document.createElement('div');
      dot.className = `progress-dot ${i === currentQuestion ? 'active' : ''}`;
      if (i < currentQuestion) {
        dot.style.background = '#228B22';
      }
      progressContainer.appendChild(dot);
    }
  }
  
  function updateScore(newPoints) {
    const scoreElement = document.getElementById('score');
    const currentScore = parseInt(scoreElement.textContent);
    const targetScore = currentScore + newPoints;
    score = targetScore;
    const duration = 1500;
    const startTime = performance.now();
    const animate = currentTime => {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const easeOut = t => 1 - Math.pow(1 - t, 3);
      const easedProgress = easeOut(progress);
      const current = Math.floor(currentScore + newPoints * easedProgress);
      scoreElement.textContent = current;
      if (progress < 1) {
        requestAnimationFrame(animate);
      }
    };
    requestAnimationFrame(animate);
  }
  
  function showRules() {
    const rulesModal = document.getElementById('rules-modal');
    rulesModal.style.display = 'flex';
  }
  
  function startGame() {
    document.getElementById('rules-modal').style.display = 'none';
    document.getElementById('category-selection').style.display = 'block';
  }
  
  function startGameWithoutRules() {
    showRulesOnStart = false;
    localStorage.setItem('showRules', 'false');
    startGame();
  }
  
  function showRulesHelper() {
    const rulesModal = document.getElementById('rules-modal');
    rulesModal.style.display = 'flex';
  }
  
  document.addEventListener('DOMContentLoaded', () => {
    const savedRulesPreference = localStorage.getItem('showRules');
    if (savedRulesPreference === 'false') {
      showRulesOnStart = false;
      document.getElementById('category-selection').style.display = 'block';
      document.getElementById('rules-helper').style.display = 'block';
    } else {
      showRules();
      document.getElementById('rules-helper').style.display = 'block';
    }
  });
  
  document.querySelectorAll('.option').forEach(option => {
    option.addEventListener('click', e => {
      const selected = parseInt(e.target.dataset.index);
      checkAnswer(selected);
    });
  });